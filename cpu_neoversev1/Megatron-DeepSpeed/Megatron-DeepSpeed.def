Bootstrap: localimage
From: pytorch_2.5.0.sif

%setup

%environment

%files

%post
  cd /opt
  git clone https://github.com/microsoft/Megatron-DeepSpeed
  cd Megatron-DeepSpeed
cat << EOF >> requirements.txt
deepspeed
ninja
numpy
packaging
pybind11
regex
six
tensorboard
torch
transformers
wandb
wheel
mpi4py
EOF
  pip install --break-system-packages -r requirements.txt

  pip list

  cd /opt/Megatron-DeepSpeed/megatron/data/
  make

%runscript
  #!/bin/sh
  export PYTHONPATH="/opt/Megatron-DeepSpeed"
  exec "$@"
